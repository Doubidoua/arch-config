define("jsonrcp",[],function(){return function(e,t){function n(t,n,r,i){var s=1e4+(e.Math.random()*1e3+1)+(new e.Date).getTime(),o={};return o.method=n,o.params=r,o.id=s,o.jsonrpc="1.0",$.ajax({type:"POST",encoding:"UTF-8",dataType:"json",contentType:"application/x-www-form-urlencoded;charset=ISO-8859-15",url:t,data:e.JSON.stringify(o)}).done(function(e){i(e)}).fail(function(e,t,n){}),s}return n}(window)}),define("geoloc",["jsonrcp"],function(e){return function(t,n){function r(){var t=navigator.geolocation,n={enableHighAccuracy:!0,timeout:1e4,maximumAge:2e4},r=function(){var t=arguments[0].coords;e("//"+document.location.hostname.replace(/^([^\.]{1,})/,"www")+"/Account/login/verify","userLocation",[t.latitude,t.longitude],function(e){})},i=function(){},s=function(e,s){(function(e,s){var o=function(t){r(t),e(t)},u=function(t){i(t),typeof s=="function"?s({failure:"geoloc",error:t}):e(null)};t.getCurrentPosition(o,u,n)})(e,s)};return this.startGeoLocation=function(e,t){return s(e,t),this},this}return r()}(window)}),define("async",[],function(){function n(e){var t,n;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function r(t,n){var r=/!(.+)/,i=t.replace(r,""),s=r.test(t)?t.replace(/.+!/,""):e;return i+=i.indexOf("?")<0?"?":"&",i+s+"="+n}function i(){return t+=1,"__async_req_"+t+"__"}var e="callback",t=0;return{load:function(e,t,s,o){if(o.isBuild)s(null);else{var u=i();window[u]=s,n(r(e,u))}}}}),define("propertyParser",[],function(){function n(t){var n=e.exec(t),i={};while(n&&n.length>2)i[n[1]]=r(n[2]||n[3]),n=e.exec(t);return i}function r(e){return t.test(e)?e=e.replace(t,"$1").split(","):e==="null"?e=null:e==="false"?e=!1:e==="true"?e=!0:e===""||e==="''"||e==='""'?e="":isNaN(e)||(e=+e),e}var e=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,t=/^\[([^\]]+)\]$/;return{parseProperties:n,typecastVal:r}}),define("goog",["async","propertyParser"],function(e,t){function r(e){var r=n.exec(e),i={moduleName:r[1],version:r[2]||"1"};return i.settings=t.parseProperties(r[3]),i}var n=/^([^,]+)(?:,([^,]+))?(?:,(.+))?/;return{load:function(e,t,n,i){if(i.isBuild)n(null);else{var s=r(e),o=s.settings;o.callback=n,t(["async!"+(document.location.protocol==="https:"?"https":"http")+"://www.google.com/jsapi"],function(){google.load(s.moduleName,s.version,o)})}}}}),define("search",["geoloc","jsonrcp","goog!maps,3,other_params:libraries=places"],function(e,t){return function(n,r){var i=function(i){var s=$(i),o=null,u=null,a,f,l,c,h,p,d,v,m,g,y,b="fr",w=[],E=[],S=["google","osm"],x=function(e){w=[];var t=e.address_components,n=t.length,r;m=e.formatted_address,f=e.geometry.location.lat(),l=e.geometry.location.lng(),w.lat=f,w.lng=l;for(var i=0;i<n;i++)r=t[i],w[r.types[0]]=r.long_name,r.types&&r.types.length>0&&r.types[0]=="administrative_area_level_2"&&(d=r.short_name);return u=s.val(),e},T=function(){var e=x(a.getPlace());return typeof o=="function"&&o(e),e},N=function(){a!==r&&(a.unbindAll(),google.maps.event.clearInstanceListeners(a),$(".pac-container").remove()),a=new google.maps.places.Autocomplete(s[0]);var e=$("#countryChoose").val();if(typeof e=="undefined"||e==="")e=b;a.setComponentRestrictions({country:e}),google.maps.event.addListener(a,"place_changed",T),n.$C.set(".pac-container").length===0&&C()},C=function(){s.keyup(function(){L()})},k=function(e){(function(t){var r="",i=n.JSON.parse(e.result),s=n.$C.get("#"+t),o=function(){var e=$(this),r=e.data("id");n.$C.get("#"+t).attr("data-id",r).val(E[r].properties.name+", "+E[r].properties.city+" ("+E[r].properties.postcode+")"),e.parent().removeClass("active")};E=i.features;for(var u=0,a=E.length;u<a;u++)if(E[u].properties.street){var f=n.JSON.stringify(E[u]);r+='<li data-id="',r+=u,r+='">',r+=E[u].properties.name||"",r+=", ",r+=E[u].properties.city||"",r+=" (",r+=E[u].properties.postcode||"",r+=")</li>"}s.parent().find("ul").html(r).addClass("active").find("li").click(o)})(s.attr("id"))},L=function(){t("/Site/default/osm-suggestions","getSuggestions",[s.val()],k)},A=function(){f=l=d=m=v=g=y=null},O=new google.maps.places.AutocompleteService,M=new google.maps.places.PlacesService(s[0]),_=function(e,t){!e||e.length===0?t(null):function(t){var n=function(e){t(x(e))};D(e[0].reference,n)}(t)},D=function(e,t){(function(t){M.getDetails({reference:e},function(e,n){t(e)})})(t)},P=function(e,t){(function(t){var n=function(e,n){_(e,t)};O.getPlacePredictions({input:e,offset:e.length,componentRestrictions:{country:b}},n)})(t)},H=new google.maps.Geocoder,B=function(e,t,n){e&&e.coords?function(t,n){var r=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);H.geocode({latLng:r},function(e,r){r==google.maps.GeocoderStatus.OK&&e.length>0?t(x(e[0])):typeof n=="function"?n({failure:"geocode",error:e,status:r,GeocoderStatus:google.maps.GeocoderStatus}):t(null)})}(t,n):typeof n=="function"?n({failure:"pos",error:e}):t(null)},j=function(t,n){(function(t,n){var r=function(e){B(e,t,n)};e.startGeoLocation(r,n)})(t,n)};return this.updatePlace=function(e){e=typeof e=="function"?e:function(){},A();var t=s.val();return t&&t.length>0?s.datas?s.datas.reference?function(e,t){var n=function(n){x(n),t.datas.label=m,t.datas.lat=f,t.datas.lng=l,t.datas.cityseo=h,t.datas.radius=v,t.datas.city=g,t.datas.of=y,e(t.datas)};D(t.datas.reference,n)}(e,s):!s.datas.city&&(!s.datas.lat||!s.datas.lng)?P(t,e):(m=s.datas.label,f=s.datas.lat,l=s.datas.lng,h=s.datas.cityseo,v=s.datas.radius,g=s.datas.city,y=s.datas.of,e(s.datas)):P(t,e):e(null),this},this.isUpdate=function(){return s.val()==u},this.isEmpty=function(){return u=u||"",($("#where").val()?$("#where").val().length:0)===0&&($("#who").val()?$("#who").val().length:0)===0},this.getLat=function(){return f},this.getLng=function(){return l},this.getWhatUrl=function(){return c},this.setWhatUrl=function(e){c=e},this.getWhereUrl=function(){return h},this.getNeedGeo=function(){return $("#fgeoloc").val()==="1"?1:0},this.setWhereUrl=function(e){h=e},this.getLabel=function(){return m},this.getCity=function(){return g},this.getOf=function(){return g},this.getDepartment=function(){return d},this.getRadius=function(){return v},this.getInput=function(){return s},this.getGeoLoc=function(e,t){return j(e,t),this},this.getPlaceByReference=function(e,t){return D(e,t),this},this.getAddressInfo=function(){return S[0]=="google"?N():C(),this},this.getRow=function(e){return e&&n.parseInt(e,10)>=0?this.getFeature(n.parseInt(e,10)):w},this.focusOut=function(e){return typeof e=="function"&&(o=e),this},this.getFeature=function(e){var t=[];return t.street_number=E[e].properties.hasOwnProperty("housenumber")?E[e].properties.housenumber:"",t.route=E[e].properties.street,t.locality=E[e].properties.city,t.postal_code=E[e].properties.postcode,t.lat=E[e].geometry.coordinates[0],t.lng=E[e].geometry.coordinates[1],t},this};return i}(window)}),define("cdhautocomplete",["jsonrcp"],function(e){return function(t,n){var r=function(n,r){var i=this,s=null,o="cdh."+n,u=864e5,a=10,f={expiration:(new t.Date).getTime()+u},l=2e4,c=function(e){if(e&&t.JSON&&e.length<l){e=t.JSON.parse(e);var n=(new t.Date).getTime();if(!e||!e.expiration||e.expiration<n)e={expiration:n+u};f=e}for(var r=0,i=v.length;r<i;r++)typeof v[r]=="function"&&v[r]();d=!0},h=function(e,t){return(e.date||0)<(t.date||0)?1:-1},p=function(e,n){var r=[],i=0,s="",u=0,l={};n.date=(new t.Date).getTime(),f[e]=n;for(s in f)r[i]={storage:f[s],value:s,date:f[s].date||0},i++;r.sort(h);for(;u<a;u++){if(typeof r[u]=="undefined")break;l[r[u].value]=r[u].storage}t.shore.set(o,l)},d=!1,v=[],m=!1,g=!1,y=function(){g||function(n){var r=function(e){n!=="expiration"&&p(n,e),g||i.callback($.extend(!0,{},f[n]))},s=[n];i.searchType=="where"&&s.push(t.$C.get("#proxy").is(":checked")),e("/data/auto-complete",i.searchType,s,r)}(i.value),m=!1},b=!1,w=function(){d?(g=!1,f[i.value]?i.callback($.extend(!0,{},f[i.value])):m||(m=!0,s=t.setTimeout(y,i.timeout))):(b=!0,v[v.length]=w,t.shore.get(o,c))};return t.shore.get(o,c),this.get=function(e,t){return this.value=e,this.callback=typeof t=="function"?t:this.callback,w(),this},this.interrupts=function(){return t.clearTimeout(s),m=!1,g=!0,this.callback=function(){},this},this.searchType=n,this.value="",this.callback=function(){},this.timeout=r||166,this.clearCache=function(e,n,r){return d?(typeof e=="string"?(delete f[e],r?this.update(e,n):typeof n=="function"&&n()):(f={expiration:(new t.Date).getTime()+u},typeof n=="function"&&n()),t.shore.set(o,f)):v[v.length]=function(e,t,n,r){return function(){e.clearCache(t,n,r)}}(this,e,n,r),this},this.update=function(e,t){return function(t,n,r){t.timeout=0;var i=function(e){t.timeout=n,r&&typeof r=="function"&&r(e)};t.get(e,i)}(this,this.timeout,t),this},this};return r}(window)}),define("validator",[],function(){var e;return e={EMAIL_REG:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gi,email:function(e){return e.match(this.EMAIL_REG)}},e}),define("login",["jsonrcp","validator"],function(e,t){return function(n){var r="//"+document.location.hostname.replace(/^([^\.]{1,})/,"www")+"/Account/login/verify",i=!1,s=!1,o=2021,u=2020,a=2122,f=2030,l=2142,c=[],h=function(e){return function(t){var r=function(e){t.showPopinLogin(e)},i=function(e){return e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),t.quickRegister(t),!1},s=function(){n.$C.set("#signin").off("click").click(r),n.$C.set("#submitQuickPopin").off("click").click(i)};t.customPopin(e),n.setTimeout(s,100)}(this),this},p=null,d=function(t){t&&typeof t.preventDefault=="function"&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),e(r,"forgottenPassPopin",[],function(i){n.$C.$html.addClass("on"),n.$C.$body.addClass("signinbox"),n.$C.set(".signin .popincontent").html(i.result),n.$C.set("#submitForgottenPopin").click(function(){return t&&typeof t.preventDefault=="function"&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),e(r,"forgottenPass",[n.$C.get("#lostPassEmail")[0].value],function(e){if(e.result.code&&e.result.code==="ok")p||(p=new g),p.showPopinLogin(),n.setTimeout(function(){n.$C.set("#loginemail")[0].value=e.result.mail,n.$C.set("#globalErr").removeClass("msg iconno").addClass("active").text(e.result.msg)},1e3);else{var t="champs invalide";c[e.result.code]!==undefined&&(t=c[e.result.code]),n.$C.set("#emailwarn").text(t),n.$C["#lostPassEmail"].addClass("required")}}),!1})})},v=function(i){return i&&typeof i.preventDefault=="function"&&(i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation()),function(i){var s=function(t){return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e("//"+document.location.hostname.replace(/^([^\.]{1,})/,"www")+"/Account/login/verify","quickRegisterPopin",["login"],function(e){e.result.code&&e.result.code==="ok"&&(p||(p=new g),p.sessTrash(e.result.page))}),!1},a=function(t){if(t.result.code&&t.result.code==="ok"){i.closePopin(),n.shore.set("userData",t.result.user);if(t.result.action){var r=t.result.action;e(r.url,r.method,r.params,function(){n.location.reload()})}else t.result.redirect.found==="OK"?n.location=t.result.redirect.url:n.location.reload();t.result.lastPage&&(n.location.href=t.result.lastPage)}},l=function(i){i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation();var s=$("#loginemail")[0].value,l=$("#loginpass")[0].value,h=$("#stayConnected").is(":checked"),p=!0,d="",v="",m=t.email(s);return m||(n.sendToGTM("event","button","click","jemeconnecte/bademail"),d=c[o],p=!1),s.length===0&&(n.sendToGTM("event","button","click","jemeconnecte/emptymail"),d=c[u],p=!1),l.length===0&&(n.sendToGTM("event","button","click","jemeconnecte/emptyemailpwd"),v=c[f],p=!1),p?e(r,"login",[s,l],function(e){if(e.result.code&&e.result.code==="ko"){n.sendToGTM("event","button","click","jemeconnecte/loginfail"),n.$C.get("#globalErr").addClass("active msg iconno").text("email ou mot de passe invalide");return}n.shore.clear("welcomebox"),h&&n.shore.set("auto_log",!0),a(e)}):(v.length>0&&(n.$C.get("#sign-pwd-warn").text(v),n.$C.get("#loginpass").addClass("required")),d.length>0&&(n.$C.get("#sign-mail-warn").text(d),n.$C.get("#loginemail").addClass("required"))),!1},h=function(e){n.$C.$html.addClass("on"),n.$C.$body.addClass("signinbox"),n.$C.set(".signin .popincontent").html(e.result),n.$C.set("#forgotten").click(d),n.$C.set("#registerpopin").click(s),n.$C.set("#submitLoginPopin").click(l),n.sendToGTM("event","button","click","jemeconnecte/top-nav"),n.common.adjustPopin()};e(r,"buildPopin",[],h)}(this),!1},m=function(){s||(s=!0,e(r,"getStatus",[],function(t){i=t.result.connected;var s=!1;n.shore.get("auto_log",function(t){s=t,s==="true"&&i===!1&&n.shore.get("userData",function(t){var i=JSON.parse(t),s=i.id,o=i.autoconnectKey;e(r,"loginByKey",[s,o],function(e){e.result.code&&e.result.code==="ok"&&n.location.reload()})})})}))},g=function(){var e=!0;return typeof isInDEGMD!="undefined"&&isInDEGMD===!0&&(e=!1),e&&m(),new g.fn.init};return c[o]='Champs "Email" invalide',c[u]='Champs "Email" requis',c[a]='votre "Email" existe',c[f]='Champs "Mot de passe" requis',c[l]='"Email" inconnu',g.fn=g.prototype={init:function(){return function(e){e.sessTrash=function(){return h.apply(e,arguments)},e.showPopinLogin=function(){return v.apply(e,arguments)},e.userIsConnected=function(){return i}}(this),this},popin:function(e){var t="";return e&&(e.title&&(t+='<p class="h2 big hardware',e.iconCss&&(t+=" ",t+=e.iconCss),t+='">',t+=e.title,t+="</p>"),e.msgError&&(t+='<p id="globalErr" class="max10 fade iconno msg after active">',t+=e.msgError,t+="</p>"),e.description&&(t+='<p class="h4">',t+=e.description,t+="</p>"),t+='<div class="tablevmiddlechild inputfull">',e.content&&(t+=e.content),e.footer&&(t+='<div class="footer">',t+=e.footer,t+="</div>"),t+="</div>"),h.call(this,t),this},quickRegister:function(i){var s=!0,f="",l=n.$C.set("#quickemail").val(),h=n.$C.set("#src").val();return n.$C["#quickemail"].removeClass("required"),t.email(l)||(f=c[o],s=!1),l.length===0&&(f=c[u],s=!1),s?function(t){var i=function(r){if(r.result.code&&r.result.code==="ok"){n.shore.set("userData",r.result.user),n.$C.set(".popincontent").html("<p class='h2 big hardware' >"+r.result.title+"</p><p class='h4'><strong>"+r.result.msg+"</strong></p>");if(r.result.action){var i=r.result.action;e(i.url,i.method,i.params,function(){n.setTimeout(function(){n.location.reload()},3e3)})}else n.setTimeout(function(){n.location.reload()},3e3);r.result.src&&r.result.src==="internal-addFavoriteWhere"&&$("#isFavorite").addClass("saved")}else f="champs invalide",c[r.result.code]!==undefined&&(f=c[r.result.code]),n.$C.set("#emailwarn").text(f),n.$C["#quickemail"].addClass("required"),a===r.result.code&&function(){n.setTimeout(function(){t.showPopinLogin()},1e3)}()};e(r,"quickRegister",[l,h],i)}(i):(n.$C.set("#emailwarn").text(f),n.$C["#quickemail"].addClass("required")),this},showPopinLogin:null,customPopin:function(e){return n.$C.$html.addClass("on"),n.$C.$body.addClass("signinbox"),n.$C.set(".signin .popincontent").html(e),n.common.adjustPopin(),this},closePopin:function(){return n.$C.$html.removeClass("on"),n.$C.$body.removeClass("signinbox"),n.setTimeout(function(){n.$C.set(".popincontent .signin").empty()},1e3),this},logout:function(t){t&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation());var i=function(){n.shore.clear("userData"),n.shore.clear("auto_log");var e=n.location.pathname.split("/");e[1]==="profile"||e[0]==="fiche"?n.location.href="/":n.location.reload()};return e(r,"logout",[],i),!1},sessTrash:null},g.fn.init.prototype=g.fn,g}(window)}),define("autocomplete",["search","cdhautocomplete","jsonrcp","login"],function(e,t,n,r){return function(i,s){var o=$('<li class="location"><strong class="icontarget">Me localiser</strong></li>'),u=$("#logo"),a=$("#proxy"),f=a.is(":checked"),l=function(){f=a.is(":checked")},c=function(e,t){return function(e,t,n){var r=function(t){return t&&t.type=="keydown"&&(e.$where?e.$where.required(!0):e.$parent&&e.$parent.required(!0),e.required(!0)),n.apply(e,arguments)},i=function(t){h(e,t)};t.off("keyup").keydown(r).keyup(r).focus(r).blur(i)}(this,e,t),this},h=function(e,t){return $(t.relatedTarget).attr("data-stopPropagation")||(e.hideAutoComplete=!0,function(e){i.setTimeout(function(){e.hideAutoComplete&&(e.$where?e.$where.required(!0):e.required(!0),e.cdh&&(e.cdh.interrupts(),e.favoriteProcessing=!1),e.focusAutoComplete())},100)}(e)),e},p=null,d="/Account/data/jaime",v=function(e,t,n){return n?y(e,t):e.displayAutoComplete.call(e,t),e.favoriteProcessing=!1,e},m=function(e,t,n,i,s){return function(e,t,n,i,s){var o="",u=!1,a=null,f=null;n&&n.result&&n.result.code=="ok"?(i?(o="Adresse ajoutée",a="iconsv",f="validated"):(o="Adresse supprimée",a="iconbasket",f="deleted"),u=!0):n.result.code=="ko"&&(n.result.msg=="session_trash"?(p||(p=new r),p.sessTrash(n.result.page)):n.result.msg=="limit_reached"?o="Limite: 6 favoris":o="Erreur"),n.result.favorites&&(e.favorite.array=n.result.favorites,e.favorite.uniqueObjects(["lib","adresse"])),o&&D(e,o,f,a),e.cdh.clearCache(),v(e,n,s)}(e,t,n,i,s),e},g=function(e,t){return function(e,t,r){var i=$(t),s=i.parent(),o=s.hasClass("favorite"),u=s.attr("data-id"),a=0,f=function(t){m(e,r,t,!0)},l=function(t){m(e,r,t)},c=null;if(u)if(!e.favoriteProcessing){e.favoriteProcessing=!0;if(o){c=e.favorite.getBy("id",u),a=c.length;for(var h=0;h<a;h++)e.history.array[e.history.array.length]={where:c[h].adresse,id:c[h].id,lat:c[h].geoy,lng:c[h].geox,lib:c[h].lib,type:c[h].type,category:c[h].category,city:c[h].city};n(d,"delFavoriteWhere",c,l)}else c=e.history.getBy("id",u),a=c.length,n(d,"addFavoriteWhere",c,f)}else D(e,"En cours",null,"iconwait");else D(e,"Erreur")}(e,t,e.$input.val()),e},y=function(e,t){var n=/^where$/i.test(e.type);return t&&t.result&&(t.result.favorites&&(e.favorite.array=t.result.favorites,e.favorite.uniqueObjects(["lib","adresse"])),t.result.history&&e.history.mergeFirst(t.result.history)),e.history.uniqueObjects(n?["where"]:["what","where"]).reduce(e.favorite.array,{where:"adresse",lat:"geox",lng:"geoy"}),T(e),n&&w(e),e},b={},w=function(e){if(e&&e.favorite&&e.favorite.array){var t=0,n=e.favorite.array.length;for(var r in b){var i=!1;for(t=0;t<n;t++)if(e.favorite.array[t].adresse==b[r].datas.adresse){i=!0;break}i?b[r].$favorite.addClass("saved"):b[r].$favorite.removeClass("saved")}}return e},E=function(e,t){return b[t]&&function(e,t){var n=function(){S(e,b[t])};b[t].$favorite.click(n)}(e,t),e},S=function(e,t){return t&&function(e,t,n){var r=function(e){n?t.$favorite.removeClass("saved"):e&&e.id&&(t.datas.id=e.id)};x(e,t.datas,n,r)}(e,t,t.$favorite.hasClass("saved")),e},x=function(e,t,r,i){return t&&function(e,i){var s=t.adresse||"",o=function(e){if(typeof i=="function"){var t=null;if(e&&e.result&&e.result.favorites)for(var n=0,r=e.result.favorites.length;n<r;n++)if(e.result.favorites[n].adresse==s){t=e.result.favorites[n];break}i(t)}},u=function(t){m(e,s,t,!0,!0),o(t)},a=function(t){m(e,s,t,!1,!0),o(t)};r?n(d,"delFavoriteWhere",[t],a):n(d,"addFavoriteWhere",[t],u)}(e,i),e},T=function(e){return i.shore.set(e.historyName,e.history.limit(10)),e},N=function(e,t,n,r){t=t||{},r=r||"";var i="",s=t.label||t[e]||t.adresse||"",o=t.where||"",u=t.lib,a=t.name?t.name+" : ":"",f=t.category||t.cat||null,l=t.categseo||null,c=t.cityseo||null,h="",p=/^where$/i.test(e),d=p?33:55,v={label:s,where:o,cat:f,categseo:l,lat:t.lat||t.geox,lng:t.lng||t.geoy,type:/^favorite$/i.test(r)?"proxy":t.type,radius:t.radius,city:t.city,cityseo:c,id:t.id,reference:t.reference,url:t._urlDetails,user:t.user,date_add:t.date_add,lib:u},m=!1;if(s.length>0){for(var g in v)/^(string|number)$/i.test(typeof v[g])&&(h+="data-",h+=g,h+='="',h+=v[g],h+='" ');i+="<li ",i+=h,/^favorite$/i.test(r)?(i+='class="favorite"><button type="button" class="iconsv btnnoskin" data-stopPropagation="true"></button><strong>',i+=p?"Où":"Qui",i+=" : </strong> ",i+=u||s,d-=a.length):(/^history$/i.test(r)?p?(i+='class="history"><button type="button" class="iconsv btnnoskin" data-stopPropagation="true"></button><strong>Où : </strong>',d-=5):(i+="><strong>Qui : </strong>",m=!0):i+=">",o.length>15&&(o=o.substring(0,12)+"...",d=33),s.length>d&&(s=s.substring(0,d-2)+"..."),i+=s.replace(n,"<span>$&</span>")),m&&t.type=="proxy"&&o.length>0&&(i+=" <strong>près de : </strong> ",i+=o),f&&!p&&(i+='<span class="icon_what_autocomplete C',i+=t.category,i+='"></span>'),i+="</li>"}return i},C=function(e){var t=e,n=function(){M.apply(t,arguments)},r=function(e){_.apply(t,arguments)};e.inputSearch.getGeoLoc(n,r)},k=function(e,t,n){n||this.focusAutoComplete();var r=$(e);if(r.hasClass("location")){var i=this,s=function(){M.apply(i,arguments)},o=function(e){_.apply(i,arguments)};this.inputSearch.getGeoLoc(s,o)}else{var u=r.attr("data-where");u!=="Ma position"&&$("#fgeoloc").remove(),this.lastLabel=r.attr("data-label")||"",this.editInput(r,t,n),u&&u.length>0&&this.$where&&(this.$where.lastLabel=u,this.$where.editInput(r,t,n))}return this},L=function(e){return e&&e.id==this.getDatas("id")&&this.setDatas({label:e.formatted_address,lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}),this},A=function(e){u.attr("class",e&&e.length>0?"right icon_what_field C"+e:"right icon_what_field")},O=function(e){return this.$where.inhibits=e,this.$where.fromWhat=!0,this.navPosition=-1,this.$where.navPosition=-1,this.$where.$input.focus(),this.inhibits=!1,this},M=function(){var e=this.inputSearch.getLabel();return $("#fgeoloc").remove(),this.setDatas({label:e,lat:this.inputSearch.getLat(),lng:this.inputSearch.getLng()}),this.$input.val(e),a.attr("checked",!0),a[0].setAttribute("checked",!0),a[0].checked=!0,document.location.search.indexOf("geolocneed=1")>-1&&$("#search").submit(),this},_=function(e){var t="";if(e&&e.error&&e.error.message&&e.error.message.indexOf("Only secure origins are allowed")===0){var n=$("#search"),r=i.location.host;n.find("#fgeoloc").remove(),n.attr("action",r.replace(/([^\.]+).(.*)/,"https://www.$2")+"/search"),n.append('<input type="hidden" id="fgeoloc" name="fgeoloc"  value="1">'),$("#where").val("Ma position"),t="Vous serez localisé pendant la recherche"}else e&&e.failure&&/^geoloc$/i.test(e.failure)?t="La localisation n'est pas active":t="échec de La localisation";return D(this,t,null,"icontarget")},D=function(e,t,n,r){return i.clearTimeout(e.warningTimeout),n=n&&n!=="warning"?"warning "+n:"warning",r=r||"iconwarning",typeof e.required!="undefined"&&(e.$warning.removeClass().addClass(n),e.$warningText.removeClass().addClass(r).text(t),e.required(),function(e){var t=function(){e.required(!0)};e.warningTimeout=i.setTimeout(t,e.warningTimeUp)}(e)),e},P=function(){return this.array=[],this},H=function(e,t,n){return new H.fn.init(e,t,n)};return H.fn=H.prototype={$input:null,$content:null,$warning:null,$warningText:null,$where:null,$parent:null,inputSearch:null,init:function(n,r,s){this.history=new P,this.favorite=new P,this.type=s||"where",this.historyName=this.type+"LastHistory",this.favoriteName=this.type+"LastFavorite",this.$content=$(r||"#whereDropDown"),this.cdh=new t(this.type);var o=this,u=function(e){y(o,e)},a="";return this.cdh.clearCache("",u,!0),/^what$/i.test(this.type)?(this.$input=$(n),a=this.$input.val(),this.$where=H("#where"),this.inputSearch=this.$where.inputSearch,this.$where.$parent=this,this.setDatas({label:a,cat:this.$input.attr("data-cat"),city:this.$input.attr("data-city")})):(this.inputSearch=new e(n||"#where"),this.$input=this.inputSearch.getInput(),a=this.$input.val()),this.lastLabel=a,this.placeholder=this.$input.attr("placeholder"),this.$warning=this.$input.nextAll(".warning"),this.$warningText=this.$warning.find("strong"),c.call(this,this.$input,this.changeField),this.editInput(this.$input,null,!0),function(e){var t=function(t){if(i.JSON&&t&&t.length>0){var n=i.JSON.parse(t);n.length>0&&e.history.mergeFirst(n)}},n=function(t){if(i.JSON&&t&&t.length>0){var n=i.JSON.parse(t);n.length>0&&e.favorite.mergeFirst(n)}};i.shore.get(e.historyName,t)}(this),this},type:"",cdh:null,available:!0,changeField:function(e){this.$where?this.$where.focusAutoComplete():this.$parent&&this.$parent.focusAutoComplete();var t=!this.navigation(e);if(!t)e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();else if(this.available){var n=this,r=function(){n.displayAutoComplete.apply(n,arguments)};this.cdh&&this.cdh.get(this.$input.val(),r)}else this.displayAutoComplete({result:{}}).available=!0;return t},historyName:"",history:null,favoriteName:"",favorite:null,showFavories:!0,favoriteProcessing:!1,manageFavoritesOut:function(e){var t=this,n=0,r=e.length,s=function(r,i){var s=e[n]+r;if(!b[s]){var o=$(i);b[s]={$favorite:o,datas:{id:o.attr("data-id"),adresse:o.attr("data-adresse"),geox:o.attr("data-geox"),geoy:o.attr("data-geoy")}},E(t,s)}};for(;n<r;n++)i.$C.get(e[n]).each(s);return this},displayAutoComplete:function(e){if(e.result){var t=this.$input.val(),n=t!==this.lastLabel;n&&(this.setDatas(),/^what$/i.test(this.type)&&A());var r=this,s=e.result.data||[],u=s.length,a=e.result.places||[],f=a.length,l=e.result.pattern||"",c=t.length===0,p=0,d="",v=new RegExp("("+l+")","gi"),m="",b="",w=12,E="",S="",x=!1,T=function(){k.call(r,this)},C=function(e){return r.hideAutoComplete=!1,g(r,this),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},L=function(e){h(r,e)};y(this,e);var O=this.favorite.array.length,M=this.history.array.length;this.$content.empty(),c&&(/^where$/i.test(this.type)?(this.$content.append(o.clone(!0)),w--):A());if(c||this.showFavories||!n)for(p=0;p<O;p++)d+=N(this.type,this.favorite.array[p],v,"favorite"),w--;if(c)for(p=0;p<M;p++)w>0&&(d+=N(this.type,this.history.array[p],v,"history"),w--);for(p=0;p<u;p++)this.type==="what"?i.common.accentsTidy(s[p].label.replace(/([\-]{1,})/g," "))==i.common.accentsTidy(this.$input.val().replace(/([\-]{1,})/g," "))&&(S===""?S=s[p].categseo:x=!0):this.type==="where"&&i.common.accentsTidy(s[p].label.replace(/ \(([0-9A-B]{2,3})\)/i,"").replace(/([\-]{1,})/g," "))==i.common.accentsTidy(this.$input.val().replace(/ \(([0-9A-B]{2,3})\)/i,"").replace(/([\-]{1,})/g," "))&&s[p].localType==6&&(E===""?E=s[p].cityseo:x=!0),d+=N(this.type,s[p],v),w--;this.type==="where"&&(this.inputSearch.setWhereUrl(null),!x&&E!==""&&this.inputSearch.setWhereUrl(E)),this.type==="what"&&(this.inputSearch.setWhatUrl(null),!x&&S!==""&&this.inputSearch.setWhatUrl(S));for(p=0;p<f;p++)d+=N(this.type,a[p],v,"places"),w--;this.$content.append(d),this.$li=this.$content.find("li").click(T),this.$li.find("button").click(C).blur(L),this.focusAutoComplete(!0),c||this.required(!0)}return this},hideAutoComplete:!0,placeholder:"",focusAutoComplete:function(e){return e?(this.showFavories=!1,this.$input.addClass("focus"),this.$content.addClass("active"),this.$input.attr("placeholder","")):(this.$input.removeClass("focus"),this.$content.removeClass("active"),this.navPosition=-1,this.$input.attr("placeholder",this.placeholder),this.showFavories=!0),this},lastLabel:"",warningTimeUp:3e3,warningTimeout:null,required:function(e){return e?this.$input.removeClass("required"):this.$input.addClass("required"),e},getDatas:function(e){var t=1;return this.$input.datas?this.$input.datas[e]:null},setDatas:function(e){return this.$input.datas=e||null,this},editInput:function(e,t,n){this.$input.val(this.lastLabel),this.lastLabel&&this.lastLabel.length>0&&this.required(!0);var r=this,i=e.attr("data-reference"),s=function(){L.apply(r,arguments)},o=e.attr("data-cat")||"",u=f;this.type==="where"&&this.inputSearch.setWhereUrl(e.attr("data-cityseo")||null),this.type==="what"&&(A(o),this.inputSearch.setWhatUrl(e.attr("data-categseo")||null));if(i)u=!0,this.setDatas({label:this.lastLabel,reference:i,id:e.attr("data-id"),url:e.attr("data-url"),cat:o});else{var l=e.attr("data-type");u=!l||!/^(local|reverse|proxy)$/i.test(l)?f:l==="proxy"?!0:!1,this.setDatas({label:this.lastLabel,lat:e.attr("data-lat"),lng:e.attr("data-lng"),radius:e.attr("data-radius"),type:l,city:e.attr("data-city"),cat:o})}return a&&a[0]&&(a.attr("checked",u),a[0].setAttribute("checked",u),a[0].checked=u),this.$where&&!n&&O.call(this,!!t),this},$li:null,navPosition:-1,inhibits:!1,notInhibits:function(){return!this.inhibits&&(!this.$where||!this.$where.inhibits)},navgeoloc:function(){var e=this;return C(e)},fromWhat:!1,navigation:function(e){e=e||i.event;if(e.type=="keydown"){var t=e.keyCode||e.charCode||e.which;t=i.parseInt(t,10),!this.inhibits&&t===40&&this.$li&&(this.inhibits=!0,this.navPosition=-1),this.inhibits&&this.$li?t===13?this.available?(k.call(this,this.$li.eq(this.navPosition),!0),this.navPosition=-1,this.available=!1):/^what$/i.test(this.type)?(this.available=!1,this.inhibits=!0,O.call(this,!0),this.focusAutoComplete()):this.inhibits=!1:(this.$li.removeClass("hover"),t===40?this.navPosition++:t===38?this.navPosition--:(this.navPosition=-1,this.inhibits=!1),this.navPosition=i.Math.min(i.Math.max(this.navPosition,-1),this.$li.length-1),this.navPosition>=0&&this.$content.hasClass("active")?k.call(this,this.$li.eq(this.navPosition).addClass("hover"),!0,!0):this.inhibits=!1):t===13&&/^what$/i.test(this.type)?(this.available=!1,this.inhibits=!0,O.call(this,!0),this.focusAutoComplete()):this.fromWhat?(this.fromWhat=!1,t!==13&&(this.inhibits=!1)):this.inhibits=!1}return this.inhibits}},P.prototype={uniqueObjects:function(e){var t=[],n=this.array.length,r=0,i=0,s=0,o=function(e,t,n){var r=!1,i=typeof e;if(i===typeof t)if(/^(string|number|boolean|undefined)$/.test(i))r=e===t;else if(/^object$/.test(i))if(e===null&&t===null)r=!0;else if(e&&t)if(n&&n.length>0)for(var s=0,u=n.length;s<u;s++){r=o(e[n[s]],t[n[s]]);if(!r)break}else for(var a in e){r=o(e[a],t[a]);if(!r)break}else r=!1;else/^function$/.test(i)&&(r=e.toString()===t.toString());return r},u=!1;for(;r<n;r++){s=t.length;if(s>0){u=!0;for(i=0;i<s;i++)if(o(this.array[r],t[i],e)){u=!1;break}u&&(t[s]=this.array[r])}else t[s]=this.array[r]}return this.array=t,this},mergeFirst:function(e){var t=0,n=this.array.length,r=(new i.Date).getTime();for(t=0;t<n;t++)e[e.length]=this.array[t];n=e.length;for(t=0;t<n;t++)e[t].id||(e[t].id=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=r+t,e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10),e[t].id+="",e[t].id+=i.Math.floor(i.Math.random()*10)),e[t].date||(e[t].date=r),this.array[t]=e[t];return this},getBy:function(e,t,n){var r=[],i=[];for(var s=0,o=this.array.length;s<o;s++)this.array[s]&&this.array[s][e]&&this.array[s][e]==t?r[r.length]=this.array[s]:n&&(i[i.length]=this.array[s]);return n&&(this.array=i),r},reduce:function(e,t){var n=this.array.length,r=e.length,i=0,s=0,o=!0,u=!0,a=null;reduceArray=[];for(i=0;i<n;i++){o=!0;for(s=0;s<r;s++){u=!0;if(t){for(a in t)if(a!=="id")if(!e[s]||!!e[s][t[a]]&&!this.array[i][a]||!e[s][t[a]]&&!!this.array[i][a]||!!e[s][t[a]]&&(typeof e[s][t[a]]!=typeof this.array[i][a]||e[s][t[a]]!==this.array[i][a])){u=!1;break}}else for(var f in this.array[i])if(f!=="id")if(!e[s]||!!e[s][f]&&!this.array[i][f]||!e[s][f]&&!!this.array[i][f]||!!e[s][f]&&(typeof e[s][f]!=typeof this.array[i][f]||e[s][f]!==this.array[i][f])){u=!1;break}if(u){o=!1;break}}o&&(reduceArray[reduceArray.length]=this.array[i])}return this.array=reduceArray,this},sortByDate:function(e,t){return(e.date||0)<(t.date||0)?1:-1},limit:function(e){var t=[],n=0,r=this.array.length;e=e>r?r:e,this.array.sort(this.sortByDate);for(;n<e;n++)t[n]=this.array[n];return t}},H.fn.init.prototype=H.fn,a.click(l),H}(window)}),define("action",["autocomplete","login"],function(e,t){require(["jsonrcp"],function(n){return function(n,r){var i=function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},s=t(),o=!1,u=function(){o=!0},a={manageFavorites:function(e){return this.favoritesTargets[this.favoritesTargets.length]=e,this},favoritesTargets:[]},f=function(){var t=e("#who","#whatDropDown","what"),r=t.inputSearch,f=n.$C.get("#search"),l=t.$input,c=r.getInput(),h=$('<input type="hidden" class="sending"/>'),p=!0,d={},v=function(){d.x=r.getLng(),d.y=r.getLat(),d.label=c.val(),d.cat=t.getDatas("cat"),d.categseo=r.getWhatUrl(),d.cityseo=r.getWhereUrl(),d.geolocneed=r.getNeedGeo();var e=null;c.datas!==null&&(e=c.datas.city),d.radius=r.getRadius(),d.city=r.getCity()||e,d.who=l.val(),n.shore.set("searchQuery",d)},m=function(){var e=$("#fgeoloc").val()==="1",t=d.who&&d.who.length>0||!r.isEmpty()||e,i=n.location.host,s="",o,u,a=!0;if(t){p=!1;if(d.categseo&&d.cityseo)n.location=i.replace(/([^\.]+).(.*)/,"//www.$2")+"/"+d.cityseo+"/"+d.categseo;else{f.attr("action",i.replace(/([^\.]+).(.*)/,(e?"https:":"")+"//www.$2")+"/search"),f.find(".sending").remove();for(s in d)o=d[s],a=!0,s==="geolocneed"&&o===0&&(a=!1),s!=="cityseo"&&s!=="categseo"&&s!=="fgeoloc"&&a&&(o||n.parseInt(o,10)===0)&&(u=h.clone(!0),u.attr("name",s),u.val(o),f.append(u));f.submit()}}return t},g=function(e){var t=!0,n=$("#fgeoloc").val()==="1";return p&&(t=i(e),y()&&(!r.isEmpty()&&r.isUpdate()||n?t=m():r.updatePlace(m))),t},y=function(){v();var e=!0,n=$("#fgeoloc").val()==="1";return t.required(e)&&(o||t.notInhibits())||n};return f.submit(g).find('button[type="submit"]').mousedown(u).keydown(u),a.manageFavorites=function(e){t.$where.manageFavoritesOut([e])},t.$where.manageFavoritesOut(a.favoritesTargets),document.location.search.indexOf("geolocneed=1")>-1&&t.$where.navgeoloc(),n.$C.get("#showPopinLogin a").click(s.showPopinLogin),n.$C.get(".btnclosepopin").click(s.closePopin),n.$C.set(".logout").click(s.logout),this};return n.$C.$doc.ready(f),a}(window)})}),define("popin",[],function(){return function(e,t){var n=768,r=function(){var t=e.innerHeight;t<=n&&e.$C.get("html, body").animate({scrollTop:e.$C.$body.offset().top},1e3)},i=function(e,t,n){return new i.fn.init(e,t,n)};return i.fn=i.prototype={init:function(t,n,r){this.name=n;var i=this,s=function(){i.openPopin()},o=function(){i.closePopin()},u=t&&t.result?t.result.page||(typeof t.result=="string"?t.result:""):"",a="popin "+this.name;return r&&(a+=" ",a+=r),u===""&&(u+='<div class="popin ',u+=this.name,u+='"><div class="popinbox boxinner"><button class="closepopin btnclosepopin"></button><p class="h4">Impossible d\'afficher le contenu de cette fenêtre !</p>Vous pouvez tenter de résoudre le problème en rafraîchissant la page.</div></div>'),e.$C.get("#generic_popin").attr("class",a).html(u).find(".closepopin").click(o),e.setTimeout(s,200),this},name:"",openPopin:function(){return e.$C.$html.addClass("on"),e.$C.$body.addClass(this.name+"box"),r(),this},closePopin:function(){return e.$C.$html.removeClass("on"),e.$C.$body.removeClass(this.name+"box"),this}},i.fn.init.prototype=i.fn,i}(window)}),define("contact",["jsonrcp","action","popin"],function(e,t,n){return function(t,r){var i=function(e,n,r,i,s,o){var u=new RegExp("^(0[1-9])(?:[ _.-]?([0-9]{2})){4}$"),a=!0;o===""&&(t.$C.set("#monmail").addClass("required"),a=!1),e===""&&(t.$C.set("#contactemail").addClass("required"),a=!1);if(n===""||n==="Sélectionnez")t.$C.set("#objetemail").addClass("required"),a=!1;return r===""?(t.$C.set("#phoneemail").addClass("required"),t.$C.get("#contactForm input[type='tel']").parent().find("p strong").text('Champ "Téléphone" requis'),a=!1):r!==null&&(r.length!=10||!u.test(r))&&(t.$C.set("#phoneemail").addClass("required"),t.$C.get("#contactForm input[type='tel']").parent().find("p strong").text("Veuillez saisir 10 chiffres"),a=!1),i===""&&(t.$C.set("#nameemail").addClass("required"),a=!1),s===""&&(t.$C.set("#messageemail").addClass("required"),a=!1),a},s=function(){var e=t.$C.set("#objetemailsec");e.length>0&&e.parent().parent().removeClass("none")},o=function(n){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();var r=t.location.href,s=t.$C.set("#contactPro").val(),o=t.$C.set("#contactemail").val(),a=t.$C.set("#objetemail").val(),f=t.$C.set("#phoneemail").val(),l=t.$C.set("#nameemail").val(),c=t.$C.set("#messageemail").val(),h=i(o,a,f,l,c,s);return h===!0&&e("/Site/details/contact","sendToContact",[o,a,s,f,l,c,r],u),!1},u=function(e){e.hasOwnProperty("result")?(t.$C.set(".msg").attr("class","msg success fade max10 iconyes after active").text(e.result.msg),t.setTimeout(f,3e3)):t.$C.set(".msg").attr("class","msg fade max10 iconno after active").text("Erreur. Mail non envoyé")},a=function(){var e=t.$C.set("#my_iframe_ct").contents().find("body").text(),n=t.$C.set("#my_iframe_ct").contents().find("body").attr("class");t.setTimeout(function(){if(e===""||!e||n==="page404")a();else{var r=JSON.parse(e);if(r.errors.length===0)t.$C.set(".msg").attr("class","msg success fade max10 iconyes after active").text("Message envoyé."),t.setTimeout(f,3e3);else{for(var i=0;i<r.errors.length;i++)t.$C.get("#"+r.errors[i]).addClass("required"),i===r.errors.length-1&&$("#my_iframe_ct").contents().find("body").text("");t.$C.set(".msg").attr("class","msg fade max10 iconno after active").text("Erreur. Mail non envoyé"),a()}}},5e3),t.$C.set("input,textarea").focus(function(){$(this).removeClass("required")})},f=function(){t.$C.$html.removeClass("on"),t.$C.$body.removeClass("transportbox contactusbox contactformbox")},l="/Site/default/contact",c=function(e){return prevUrl=t.$C.get("#datarefurl").data("refurl"),t.$C.get("#linkCorrection").click(function(){e.contactformbox("correction",prevUrl)}),t.$C.get("#serviceClient").click(function(){e.contactformbox("serviceclient",prevUrl)}),t.$C.set(".linkCommercial").click(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var n=$(this).attr("rel");return n!==""?e.contactformbox(n,prevUrl):e.contactformbox("commercial",prevUrl),!1}),t.$C.set(".linkedForm").click(function(n){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();var r=$(this),i=r.attr("id");return i==="linkCommercial"?e.contactformbox("commercial",prevUrl):i==="linkPartenariat"?e.contactformbox("partenariat",prevUrl):i==="linkRecrutement"?e.contactformbox("recrutement",prevUrl):i==="linkProPage"&&(r.closest("article").data("pro")==="pro"?t.location.href="/profile/mesfiches":t.location.href="/registration?r=pro&cksrc=footer-info#pro"),!1}),t.$C.set(".page3 .iconhelp").click(function(){e.contactformbox("help",prevUrl)}),$("#my_iframe_ct").onload=a(),e},h=function(){return c(this),this.contactformshare=function(r,s,o){return o=o||t.location.href,function(r,s,o){e(l,"contactShareBuild",[r,s,o],function(a){var f=function(n){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();var a=t.$C.set("#contactemail").val(),f=t.$C.set("#monemail").val(),c=t.$C.set("#nameemail").val(),h=t.$C.set("#messageemail").val(),p=i(a,null,null,c,h,f);return p&&e(l,"share",[r,s,a,f,c,h,o],u),!1};n(a,"contactform","ffpopin"),t.$C.set("#contactForm input, #contactForm textarea").focus(function(){$(this).removeClass("required")}),t.$C.set("#contactForm").submit(f)})}(r,s,o),this},this.contactformbox=function(r,s){return function(r){e(l,"contactForm",[r],function(o){r==="recrutement"&&a();var f=function(n){var o=t.$C.set("#urldel").val(),a=t.$C.set("#contactemail").val(),f=t.$C.set("#objetemail").val(),c=t.$C.set("#phoneemail").val(),h=t.$C.set("#nameemail").val(),p=t.$C.set("#messageemail").val(),d=null,v=i(a,f,c,h,p),m=!0;return r!=="recrutement"&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),m=!1),r==="recrutement"&&(d=t.$C.set("#attachement").val()),v&&(t.$C.set(".btsendem").hide(),e(l,"contactUs",[r,a,f,"",c,h,p,o,d,s],u)),m};n(o,"contactform","ffpopin"),t.$C.set("#contactForm input, #contactForm textarea").focus(function(){$(this).removeClass("required")}),t.$C.set("#objetemail").change(function(){var e=$(this).val();e==="contact:SupAU"?t.$C.set("#urldel").parent().parent().removeClass("none"):t.$C.set("#urldel").parent().parent().addClass("none")}),t.$C.set("#contactForm").submit(f)})}(r),this},this.contactformdetails=function(){var r=t.$C.get("#detail-top").data("info");return e("/Site/details/contact","contact",[parseInt(r.categories,10),r.comCode],function(e){n(e,"contactform","ffpopin"),t.$C.set("#objetemail").change(s),t.$C.set("#contactForm").submit(o)}),this},this};return h()}(window)}),define("fiche",["jsonrcp","autocomplete","search","action","contact"],function(e,t,n,r,s){return function(t,r){var s="/Account/fiche/fiche",o=!1,u=null,a=null,f=null,l=function(){t.setTimeout(function(){var e=u.getInput().data("id"),n=u.getRow(e),r=n.street_number||"",i=n.route||"",s=n.locality||n.administrative_area_level_1,o=n.sublocality_level_1;s&&i?(t.$C.get("#addressline").val(r+" "+i),typeof n.postal_code=="undefined"?($("#messcp").html("Saisissez manuellement votre Code Postal"),t.$C.get("#cp").val("").attr("readonly",!1).removeClass("disabled").addClass("error").addClass("required")):(t.$C.get("#cp").attr("readonly",!0).addClass("disabled").removeClass("error").removeClass("required").val(n.postal_code),$("#messcp").html("Champs obligatoire")),t.$C.get("#city").val(s),t.$C.get("#lat").val(n.lat),t.$C.get("#lng").val(n.lng),t.$C.get("#num").val(r),t.$C.get("#street").val(i),o&&t.$C.get("#cad").val(o)):(t.$C.get("#adressepro").addClass("required"),t.$C.get("#addressline").val(""),t.$C.get("#cp").val(""),t.$C.get("#city").val(""),t.$C.get("#lat").val(""),t.$C.get("#lng").val(""),t.$C.get("#num").val(""),t.$C.get("#street").val(""))},500)},c=function(){if(a==null){f=$("#cp").val();if(f.length>3){var e="";switch(f.substring(0,3)*1){case 971:e="gp";break;case 973:e="gf";break;case 974:e="re";break;case 972:e="mq";break;case 976:e="yt";break;case 977:e="bl";break;case 978:e="mf";break;case 975:e="pm";break;default:e="fr"}$("#countryChoose").val(e)}a=new n("#adressepro")}u=a.getAddressInfo(),u.getInput().focusout(l)},h=t.$C.get("#categorie"),p=t.$C.get("#catDropDown"),d=function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},v=function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.$C.set(".newcat").removeClass("none"),!1},m=function(){b($(this).val())},g="",y={},b=function(n){(function(n){var r=function(e){y[n]=e;var r=t.JSON.parse(e.result),i="";for(var s in r)if(r.hasOwnProperty(s)){var o=r[s],u=o.label;i+='<li data-label="',i+=u,i+='" data-categories="" data-id="',i+=o.id,i+='" data-reference=""><span>',i+=u,i+="</span></li>"}p.html(i).find("li").mousedown(w)};g!=n&&n.length>=3?y[n]?r(y[n]):t.setTimeout(function(){e("//"+document.location.hostname.replace(/^([^\.]{1,})/,"www")+"/Account/login/verify","getSuggestCategories",[n],r)},500):y[n]?r(y[n]):r({result:"{}"})})(n),g=n},w=function(){var e=$(this),n=t.$C.set(".catelem").length,r=n+1,i=e.attr("data-id"),s=e.attr("data-label"),o=!0,u=function(){return $(this).val().split("||")[0]==i&&(t.$C.get(".addElemCat .warning").addClass("catAlert").find("strong").html("Vous avez déjà saisi cette catégorie."),o=!1),o};t.$C.set(".addElemCat .warning"),t.$C.set(".allcatElem .elemremp").each(u);if(n<8){if(o){var a='<div class="mt1 catelem"><label class="h4 w25" for="activity'+r+'">'+(n===0?"Activité(s) : *":"")+'</label><div><input type="hidden"  data-max="100" data-grp="1" data-rule="(.+)"  class="elemremp" value="'+i+"||"+s+'"  id="autog_CAT_'+r+'_hide" name="autog_CAT'+r+'_hide" /><input type="text" class="disabled" readonly="readonly" id="activity'+r+'" value="'+s+'"/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><p class="action"><button type="button" class="catdel btndelete"></button></p></div>';n===0?t.$C.set(".addElemCat").before(a):t.$C.set(".catelem").last().after(a),B(),t.$C.get(".addElemCat .warning").removeClass("catAlert")}}else t.$C.get(".addElemCat .warning").addClass("catAlert").find("strong").html("Vous avez déjà saisi 8 catégories.");t.$C.set(".newcat").addClass("none")},E=function(e){e?$(e).find(".addInter").click(C):t.$C.set(".addInter").unbind("click").click(C)},S=function(e){e?$(e).find(".btndelete").click(k):t.$C.set(".schedules .btndelete").unbind("click").click(k)},x=function(e){return t.parseInt(e,10)<10?"0"+e:e},T=function(e,t,n){var r="",i=x(t)+":"+x(n);return r+="<option",e==i&&(r+=' selected="selected"'),r+=">",r+=i,r+="</option>",r},N=function(e,t){var n="",r=60/t,i=0,s=1;for(i=0;i<24;i++){n+=T(e,i,0);for(s=1;s<t;s++)n+=T(e,i,r*s)}return n},C=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var n=$(this),r=n.parent().attr("data-group"),i=4,s="",o="",u=t.$C.set(".blc"+r),a=u.find("select"),f=a.length,l=f/2,c=l+1,h='<div class="mt1 blc'+r+'">';if(l>0&&f>0){var p=a.last().val(),d=p.split(":"),v=t.parseInt(d[0],10);s=(v+1<24?x(v+1):23)+":"+d[1],o=(v+2<24?x(v+2):23)+":"+d[1],h+='<div class="w25"></div>'}else h+='<label class="h4 w25" for="',h+=r,h+='">',h+=r,h+="</label>";return h+='<p><select id="',h+=r,h+="_",h+=c,h+='_deb" name="',h+=r,h+="_",h+=c,h+='_deb">',h+=N(s,i),h+='</select></p><strong class="w42p txtcenter">à</strong><p><select id="',h+=r,h+="_",h+=c,h+='_end" name="',h+=r,h+="_",h+=c,h+='_end">',h+=N(o,i),h+='</select></p><p class="action"><button type="button" class="btndelete"></button></p></div>',f===0?u.replaceWith(h):l===0?n.before(h):u.last().after(h),S(),!1},k=function(){var e=$(this).parent().parent();if(e.find("label").length>0){var n=e.attr("class").replace("mt1","").trim(),r=n.replace("blc","");t.$C.set("."+n).length==1?(newBloc='<div class="mt1 ',newBloc+=n,newBloc+='"><label class="h4 w25">',newBloc+=r,newBloc+='</label><h3 class="close txtcenter">Fermé</h3><p class="action" data-group="',newBloc+=r,newBloc+='"><button type="button" class="btnadd addInter"></button></p></div>',e.replaceWith(newBloc),E()):(e.next().html(e.next().html().replace('<div class="w25"></div>','<label class="h4 w25">'+r+"</label>")),e.remove(),S())}else e.remove()},L=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],A=L.length,O=function(){var e=t.$C.set(".blcLundi").html();for(i=1;i<A;i++)t.$C.set(".blc"+L[i]).replaceWith('<div class="mt1 blc'+L[i]+'">'+e.replace(/Lundi/g,L[i])+"</div>");S(),E()},M=function(){var e="",n="",r="",i=0,s="";for(var o=0;o<A;o++){var u=t.$C.set(".blc"+L[o]).find("select"),a=u.length,f=-1,l=!1;t.$C.get("#currentdayint").val()==o+1&&(l=!0),l?r+='<li class="selected"><strong class="w30 h4 iconlower">':r+='<li><strong class="w30 h4">',r+=L[o],r+='</strong><p class="h4 txtright">',a>0?i++:r+="Fermé";for(var c=0;c<a;c++){var h=t.$C.set("#"+u[c].id).val(),p=h.replace("h","")*1;if(p<=f){e="Les horaires de "+L[o]+" ne sont pas corrects";break}r+=h,r+=c%2===0?"-":"<br>",f=p}r+="</p></li>";if(e!=="")break}return H=t.tinymce.get("schdescription"),H!==null&&typeof H!="undefined"&&(s=H.getContent()),n="<p></p>"+s+'<p></p><div class="sch mt1"><ul class="tablechild boxinner">'+r+"</ul></div>",[i,e,n]},_=function(){t.tinymce.init({mode:"specific_textareas",editor_selector:"mceEditor",language:"fr",theme:"modern",relative_urls:!1,menubar:!1,statusbar:!1,toolbar1:"bold italic"}),t.tinymce.init({mode:"specific_textareas",editor_selector:"mceEditorImg",language:"fr",theme:"modern",menubar:!1,statusbar:!1,relative_urls:!1,plugins:["advlist","autolink","lists","link","image","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","jbimages"],toolbar:"bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | image jbimages",setup:P})},D=$('<label class="tinymceplaceholder"></label>'),P=function(e){var n=t.$C.get("#"+this.id);if(n&&n.length>0){var r=n[0].placeholder||n.attr("placeholder");r&&r.length>0&&function(e,t,n,r){var i=function(){t.hide()},s=function(){e.getContent()===""&&t.show()},o=function(){e.getContent()!==""&&i(),$(e.getDoc()).contents().find("body").focus(i).blur(s)};t.html(r),n.before(t),e.on("init",o)}(e,D.clone(!0),n,r)}return this},H=null,B=function(e){e?$(e).find(".btndelete").click(F):t.$C.set(".allcatElem .btndelete").unbind("click").click(F)},j=function(e){e?$(e).find(".coordel").click(F):t.$C.set(".coordel").unbind("click").click(F)},F=function(){$(this).parent().parent().remove(),t.$C.set(".addElemCat .warning").removeClass("catAlert"),t.$C.set(".catelem:first label").text("Activité(s) : *")},I=["email1","email2","site1"],q=function(e){var t=e.find(".edited");Q=!1,t.hasClass("active")||(t.addClass("active"),e.addClass("editable"))},R=function(e,t){e.parent().find(".warning strong").text(t),e.addClass("required")},U=function(){t.$C.set(".error-box").remove()},z=function(){W(this)},W=function(e){$(e).removeClass("required")},X=function(){var e=$(this).parent(),t=e.attr("data-group"),n=e.find(".edited");n.hasClass("active")?(n.removeClass("active"),e.removeClass("editable")):(n.addClass("active"),e.addClass("editable"))},V=function(e){var n=$(this),i=n.parent().parent(),s=n.attr("data-group"),o=rt(n,!0),u=t.isNaN(o[0])?0:o[0],a=u<10?"iconwarning":"",f=!0,l,c,h;s!="picture"&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),f=!1);if(s==="news"||s==="bonsplans"){var p="#actu_start",d="#actu_end",v="actu",m="";s==="bonsplans"&&(p="#bp_start",d="#bp_end",v="bonsplans"),H=t.tinymce.get(v),H!==null&&H!==r&&(m=H.getContent());var g=t.$C.get(p).val(),y=t.$C.get(d).val();m.length>0&&(g===""||y==="")?(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),f=!1,t.$C.get(p).addClass("error"),t.$C.get(d).addClass("error"),o[1]="error"):(t.$C.get(p).removeClass("error"),t.$C.get(d).removeClass("error"))}else s==="addresse"&&(u=0,l=$.trim(t.$C.get("#addressline").val()),c=$.trim(t.$C.get("#cp").val()),h=$.trim(t.$C.get("#city").val()),l!==""&&l.length>6&&(u+=34),c!==""&&c.length===5&&(u+=34),h!==""&&h.length>2&&(u+=34),u<100&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),f=!1));return _t(),u>100&&(u=100),tt(i.find(".progressbar"),u,a),t.$C.get("#prct_"+s).val(u),o[1]===""&&(s!=="picture"&&i.find(".preview").html(o[3]),t.$C.get("#adressepro").removeClass("required"),(s!=="addresse"&&l===""||c===""||h==="")&&t.$C.get("#adressepro").addClass("required"),(s!="addresse"||s=="addresse"&&!t.$C.get("#adressepro").hasClass("required"))&&n.removeClass("editable").find(".edited").removeClass("active")),xt(),f},J=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var n=$(this),r=n.attr("data-type"),i=n.attr("data-target"),s="",o=!0,u=t.$C.set("."+i).length,a=u+1,f=t.$C.set(".telelem").length+t.$C.set(".mobelem").length+t.$C.set(".faxelem").length;return r=="tel"?(f>4&&(o=!1),s='<div class="telelem mt1"><label class="h4 w25" for="tel'+a+'">'+(u===0?"Mon téléphone principal :":"Mon "+a+"ème téléphone :")+'</label><div><input type="text" id="tel'+a+'" name="tel'+a+'" placeholder="mon numéro" data-max="50" data-grp="1" data-rule="^([0-9]{10})$" class="elemremp phonenums" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><div class="w21p"></div><div><input type="text" id="dltel'+a+'" placeholder="désignation de ligne" name="dltel'+a+'" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div>'+(u===0?"":'<p class="action"><button type="button" class="coordel btndelete"></button></p>')+"</div>"):r=="mail"?(a>2&&(o=!1),s='<div class="mt1 mailelem"><label class="h4 w25" for="email'+a+'">'+(u===0?"Mon Email principal :":"Mon "+a+"ème Email :")+'</label><div><input type="text" id="email'+a+'" placeholder="mon email" name="email'+a+'" value="" data-max="50" data-grp="2" data-rule="^([a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4})$" class="elemremp"/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><p class="action"><button type="button" class="coordel btndelete"></button></p></div>'):r=="mobile"?(f>4&&(o=!1),s='<div class="mobelem mt1"><label class="h4 w25" for="mob'+a+'">'+(u===0?"Mon mobile :":"Mon "+a+"ème mobile :")+'</label><div><input type="text" id="mob'+a+'" placeholder="mon mobile" name="mob'+a+'" data-max="50" data-grp="1" data-rule="^(0[6-7]{1}[0-9]{8})$" class="elemremp phonenums" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><div class="w21p"></div><div><input type="text" id="dlmob'+a+'" placeholder="désignation de ligne" name="dlmob'+a+'" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><p class="action"><button type="button" class="coordel btndelete"></button></p></div>'):r=="fax"&&(f>4&&(o=!1),s='<div class="faxelem mt1"><label class="h4 w25" for="fax'+a+'">'+(u===0?"Mon fax :":"Mon "+a+"ème fax :")+'</label><div><input type="text" id="fax'+a+'" placeholder="mon fax" name="fax'+a+'" data-max="50" data-grp="1" data-rule="^([0-9]{10})$" class="elemremp numfax" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><div class="w21p"></div><div><input type="text" id="dlfax'+a+'" placeholder="désignation de ligne" name="dlfax'+a+'" value=""/><p class="warning"><strong class="iconwarning">Champ obligatoire</strong></p></div><p class="action"><button type="button" class="coordel btndelete"></button></p></div>'),o&&(u===0?n.before(s):t.$C.set("."+i).last().after(s)),j(),!1},K=function(){$(this).submit()},Q=!0,G=function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),nt(),Q=!0,t.$C.get(".mainErrorArea").empty(),t.$C.get("form.summary").each(K),Q&&Y(),!1},Y=function(){t.setTimeout(function(){o?Y():Z()},500)},Z=function(){Mt(),t.$C.get("html").addClass("on"),t.$C.$body.addClass("waitingbox"),t.scrollTo(0,0),e(s,"ficheEdit",t.$C.get(".validall").parent().serializeArray(),et)},et=function(n){var r=n.result,i=r.nextStep;U(),ut();if(i=="codeTell")t.$C.$body.addClass("codetelbox"),t.$C.get("#validationTel").find(".num2call").html(r.num2Call),t.$C.get("#validationTel").find(".fromnum").html(r.mainTel),t.$C.get("#validationTel").find(".numcode").html(r.codeTel),function(n){var r=function(){e("/Account/fiche/fiche","getPhoneValidationStatus",[n],i)},i=function(e){e&&e.result&&e.result.status==1?t.goTo("/fiche"):t.setTimeout(r,3e3)};i()}(r.ficheId);else if(i=="saveFicheOK")t.$C.$body.addClass("finalregbox");else if(i=="askPayment"){t.$C.$body.addClass("paymentbox");var s=$.parseJSON(r.extra);t.$C.get("#payDescription").val(s.libelle),t.$C.get("#payOrderId").val(s.rid),t.$C.get("#payAmount").val(s.ttcprix),t.$C.get("#extraD").val(r.payobject),t.$C.get("#calcH").val(s.phash),t.$C.get("#submitPay").click(st),t.$C.get("#cgvOK").click(z)}else{t.$C.get("html").removeClass("on");var o="Une erreur empêche la validation de cette fiche";i=="errSaveFicheNoTel"?o="Votre fiche ne contient aucun numéro de téléphone":i=="errSaveFicheNoCat"?o="Votre fiche ne contient aucune activité":i=="errSaveFicheCatInconnu"?o="Votre fiche est en activité non renseignée, merci de saisir une activité plus précise":i=="errFicheUse"?o="Cette fiche a déjà été associée à un autre Espace Pro.":i=="retry"&&(o="Séquence non autorisée : "+r.text),t.$C.get(".mainErrorArea").addClass("active").html(o)}},tt=function(e,t,n){$(e).find("span").attr("class","value wp"+t+" "+n).html(t+"%")},nt=function(){var e=[],n=function(){var n=$(this),r=n.parent().parent().find("form"),i="",s=rt(r,!1),o=t.parseInt(s[0],10),u=r.attr("data-group");o=t.isNaN(o)?0:o,n.attr("id")!="myprogressbar"&&n.parents(".poll").length===0&&(o<10?i="iconwarning":o>100&&(o=100),r.data("group")!="news"&&r.data("group")!="bonsplans"&&(e[e.length]=o),tt(n,o,i))},r=0;t.$C.get(".progressbar").each(n);for(var i=0,s=e.length;i<s;i++)r+=e[i];var o=t.Math.round(r/s);tt("#myprogressbar",o,""),t.$C.get("#prct_total").val(o),xt()},rt=function(e,n){var i=0,s=e.find(".elemremp"),o=[],u=e.attr("data-group"),a="",f="",l="",c="",h="",p="",d=!0,v=function(){var s=$(this),l=s.val(),d=s.attr("data-grp"),v=s.attr("data-max")*1,m=s.attr("data-mandatory"),g=s.attr("data-rule"),y=s.attr("data-validation"),b=m?!0:!1,w=l!=="",E=s.attr("id");if(g){var S=new t.RegExp(g,"i"),x=S.test(l);y&&y=="no"&&(x=!x),x?n&&(h="<p>",p="</p>",u=="activity"?(h='<h3 class="iconlower">',p="</h3>",extract=l.split("||"),c+=c!==""?" - ":"",c+=extract[extract.length-1]):u==="coordbox"?l===""||!s.hasClass("phonenums")&&!s.hasClass("numfax")||(c+=c!==""?", ":"",c+=l):(c+=c!==""?" - ":"",c+=l),u=="summary"&&(h='<h2 class="title big">',p="</h2>"),u=="coordbox"&&(h='<h2 class="phone">',p="</h2>")):(w=!1,(b||l!=="")&&n&&(f=E,f=="site1"?a="Veuillez entrer une url valide http://www.exemple.com/":a="Ce champ est incorrectement renseigné",R(s,a),q(e)))}n&&(objJS=E,I.inArray(objJS)||(console.log(s),l.match(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/)&&(f=objJS,a="Les liens internet ne sont pas autorisés dans ce champ",R(s,a),q(e)))),v>0&&w&&(d?(o[d]===r&&(o[d]=0),o[d]<v&&(o[d]=v)):i+=v)};if(u=="infop")c+=it(),c!==""&&(c="Moyens de paiement : "+c);else if(u=="coordbox"&&n)telIsOk=!1,e.find(".phonenums").each(function(){$(this).val()!==""&&(telIsOk=!0)}),telIsOk||(d=!1,a="Vous devez saisir un numéro de téléphone ou de mobile",R(t.$C.get("#tel1"),a),q(e));else if(u=="infocompany"){d=!1;var m=t.$C.get("#siret"),g=m.val();ot(g)?(m.removeClass("required"),i+=t.parseInt(m.attr("data-max"),10),l="<ul><li><strong>Siret :</strong> "+g+"</li><li><strong>Siren :</strong> "+g.substring(0,9)+"</li></ul>"):n&&(f="Siret",a="Le Siret "+g+" n'est pas valide",R(m,a),q(e))}else if(u=="addresse"){d=!1;var y=t.$C.get("#addressline").val(),b=t.$C.get("#cp"),w=b.val(),E=t.$C.get("#city").val(),S=t.$C.get("#cad");!w.match(/^([0-9AB]{5})$/)||w===""?(a="Le code postal est incorrect",R(b,a)):b.removeClass("error"),y!=="undefined"&&(c+=y,c+=", "),w!=="undefined"&&(c+=w,c+=" "),E!=="undefined"&&(c+=E),l="<h4>"+c+"</h4>",t.$C.get("#lat").val()!==""&&t.$C.get("#lng").val()!==""&&(i=100);var x=S.val();x.match(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/)&&(a="Les liens internet ne sont pas autorisés dans ce champ",R(S,a))}else if(u=="picture"){d=!1,i=0;var T=t.$C.get(".imglprv p img").prop("src");T!==""&&T!==r&&(i=100)}else if(u=="schedules"){d=!1,i=0;var N=M();a=N[1],a===""?(N[0]>1&&(i=100),t.$C.get("#messHo").html(""),n&&(l=N[2])):(t.$C.get("#messHo").addClass("active").html("<p>"+a+"</p>"),q(e))}else if(u=="news"||u=="bonsplans"){var C="#actu_start",k="#actu_end",L="actu",A=".actuTab",O="";u==="bonsplans"&&(C="#bp_start",k="#bp_end",L="bonsplans",A=".bonplandTab"),H=t.tinymce.get(L),H!==null&&H!==r&&(O=H.getContent());var _=t.$C.get(C).val(),D=t.$C.get(k).val();if(!(O.length>0)||_!==""&&D!=="")O.length>10?(i=100,l=O.replace(/<img([^>]{1,})>/i," ... ")):$(A+" table.actu").find("tr.actuactif").length>0&&(i=100,l=$(A+" table.actu").find("tr.actuactif").find("td")[0].innerHTML);l.length>0&&e.find(".previewnojs").removeClass("previewnojs").addClass("preview"),e.find(".preview").html(l)}else if(u=="qualifier"){l='<div class="poll"><h2 class="iconheart">'+t.$C.get("#company").val()+' pour :</h2><ul class="tablevmiddlechild qualifierslist">';var P=function(){var e=$(this),n=t.parseInt(e.data("display"),10);if(!e.parents("li").hasClass("disabled")){var r=e.data("value"),s=e.data("id"),o=e.attr("data-info"),u=e.data("votes");l+='<li><p class="progressbar"><strong class="wp0 qualifier" data-value="',l+=r,l+='" data-votes="',l+=u,l+='">',l+=r,l+='</strong></p><p class="ilikeitfor txtcenter"><button type="button" data-id="',l+=s,l+='" data-info="',l+=o,l+='" class="btnilike nolove"><strong class="front">',l+=u,l+='</strong><span class="back"></span></button></p></li>',i=100}};e.find("#qualifierList .qualifier").each(P),l+="</ul></div></div>"}if(d){s.each(v),l+=h,l+=c,l+=p;for(var B in o)B!="inArray"&&(i+=o[B])}if(n){var j={},F="";$.each($(e).serializeArray(),function(n,i){var s=i.value,o=0;if(i.name=="actu"||i.name=="bonsplans"||i.name=="schdescription")H=t.tinymce.get(i.name),H!==null&&H!==r&&(s=H.getContent()),valCheck=s.replace(/<img([^>]{1,})>/i,""),valCheck.match(/[-.\w]+[ \[(]*(@|at|arobase)[ \])]*[-.\w]+[ \[(]*(dot|point|pt)+[ \])]*[\w]{2,6}/)||valCheck.match(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/)?(f=i.name,o=1,a="Les liens internet ne sont pas autorisés dans ce champ",R(t.$C.get("#"+i.name),a),q(e)):W("#"+i.name);o===0&&(j[i.name]=s)}),F=t.JSON.stringify(j),t.$C.get("#"+u+"_resume").val(F)}return[i,a,f,l]},it=function(){var e="",n=t.$C.set(".checkInfo"),r=function(){var t=$.trim(this.value);this.type=="checkbox"?this.checked?(e+=t,e+=";"):e=e.replace(t+";",""):(e=e.replace(/\[\*\][^\[]*\[\*\];/g,""),e+="[*]",e+=t,e+="[*];"),e=e.replace(/\[\*\]\[\*\];/g,"")};return n.each(r),t.$C.get("#edmoyenpay").val(e),e=e.replace(/;/g," - "),e=e.replace(/\[\*\]/g,""),e},st=function(){t.$C.get("#cgvOK").is(":checked")?t.$C.get("#payForm").submit():R(t.$C.get("#cgvOK"),"Vous devez accepter les CGV pour continuer")},ot=function(e){var n=!1,r=e.length,i=14;if(!t.isNaN(e)&&r==i){var s=0,o=0;for(var u=0;u<i;u++)o=t.parseInt(e.charAt(u),10),u%2===0&&(o*=2,o>9&&(o-=9)),s+=t.parseInt(o,10);n=s%10===0}return n},ut=function(){t.$C.$html.removeClass("on"),t.$C.$body.removeClass("waitingbox codetelbox paymentbox finalregbox")},at=null,ft=function(){t.$C.set("#fileLogoPath").val(""),t.$C.set("#prct_picture").val("0"),t.$C.set("#picture_resume").val(t.JSON.stringify({prct_picture:"0",fileLogoPath:""})),t.$C.set(".imglprv").empty(),t.$C.set(".proglogo").find("span").attr("class","value wp0 ").html("0%"),t.$C.set("#fileLogo").val("")},lt=function(){t.$C.set(".dellogo").unbind("click").click(ft)},ct=function(){$("#fileLogo").val()!==""?(o=!0,_t(),t.$C.get(".imglprv").html("<p>Chargement de votre logo en cours ...</p>"),t.setTimeout(dt,5e3)):o=!1},ht="",pt=function(){ht=""},dt=function(){var e=t.$C.get("#uplodfrm").contents().find("body").text();e!==""?e!="KO"?(ht=e,t.$C.get("#fileLogoPath").val(ht),t.$C.get("#picture_resume").val(t.JSON.stringify({prct_picture:"100",fileLogoPath:ht})),o=!1,vt()):t.$C.get(".imglprv").html("<p>Votre logo n'est pas valide</p>"):t.setTimeout(dt,3e3)},vt=function(){var e=0;ht!==""?(t.$C.get(".imglprv").removeClass("no-logo").html('<p><img src="/user/logosUsers/'+ht+'"/></p><div><input type="button" value="Supprimer le logo" class="w100 dellogo"></div>'),lt(),e=100):t.$C.get(".imglprv").addClass("no-logo").empty(),tt(t.$C.get(".proglogo"),e,"")},mt=function(){var n=$(this);if(!n.hasClass("loader")){var r=n.parents("li").find("strong");(function(r,i,s,o){var u=function(){o&&n.addClass("btna iconwait")},a=function(){o=!1,i?r.removeClass("loader btna iconwait").addClass("btndelete").parents("li").removeClass("disabled"):r.removeClass("loader btna iconwait").addClass("btnadd").parents("li").addClass("disabled")};t.setTimeout(u,300),n.removeClass("btnadd btndelete").addClass("loader"),e("/Account/fiche/fiche","displayQualifier",[s,Tt,i],a)})(n,n.hasClass("btnadd"),r.data("id"),!0)}},gt=new t.RegExp(t.$C.get("#newquality").data("rule"),"i"),yt=function(){var e=t.$C.get("#newquality").val();if(e==="")R(t.$C.get("#newquality"),"Champ obligatoire");else if(!gt.test(e))R(t.$C.get("#newquality"),"caractères interdits");else{var n=!0,r=function(){return e==$(this).data("value")&&(n=!1),n};t.$C.get(".qualifiers .qualifier").each(r),n?bt(e,wt):R(t.$C.get("#newquality"),"Cette qualité existe déjà")}},bt=function(t,n){(function(t,n){var r=function(e){e&&e.result&&e.result.code=="ok"&&e.result.qualifId?(Et(t,e.result.qualifId),n(!0)):n()};e("/Account/data/qualifier","addUserFicheQualif",[t,Tt],r)})(t,n||function(){})},wt=function(e){e?t.$C.get("#newquality").val(""):R(t.$C.get("#newquality"),"Une erreur est survenue")},Et=function(e,n){var r='<li><p class="progressbar"><strong class="wp0 qualifier" data-value="'+e+'" data-id="'+n+'" data-votes="0" data-display="1">'+e+'</strong></p><p class="ilikeitfor txtcenter"><button type="button" class="btndelete"></button></p></li>';t.$C.get("#qualifierList").append(r).find("button:last").click(mt),t.$C.set(".qualifiers .qualifier")},St=function(){(function(n){var r=n.hasClass("iconcheck"),i=n.parents("li").find(".qualifier"),s=i.data("value"),o=function(e){e?n.parents("li").remove():R(t.$C.get("#newquality"),"Une erreur est survenue")};r?bt(s,o):e("/Account/data/qualifier","removeUserFicheQualif",[s,Tt],o)})($(this))},xt=function(){var e=0,n=function(){var n=t.parseInt($(this).data("votes"),10);n=t.isNaN(n)?0:n,e=e>n?e:n},r=function(){var n=$(this),r=t.parseInt(n.data("votes"),10);r=t.isNaN(r)?0:r,n.attr("class","wp"+(e>0?t.Math.round(r*100/e):0)+" qualifier")};t.$C.set(".qualifiers .progressbar strong").each(n).each(r)},Tt=t.$C.get("#comcode").val(),Nt=t.$C.get("#fid").val(),Ct=function(){var e=$(this).data("id")==1;t.$C.get(e?"#edactu":"#edbp").hide(),t.$C.get(e?".actuTab":".bonplandTab").show()},kt=function(){var e=$(this).data("id")==1;t.$C.get(e?"#actu_id":"#bp_id").val("-1"),t.$C.get(e?"#actu_start":"#bp_start").val(""),t.$C.get(e?"#actu_end":"#bp_end").val(""),t.tinymce.get(e?"actu":"bonsplans").setContent(""),t.$C.get(e?"#edactu":"#edbp").show(),t.$C.get(e?".actuTab":".bonplandTab").hide()},Lt=function(){var n=$(this);(function(n,r){var i=function(e){e&&e.result&&t.$C.set("#actbprow"+n).remove()};e("/Account/fiche/fiche","delFicheActu",[n],i)})(n.data("rel"),n.data("id"))},At=function(){var n=$(this);(function(n,r){var i=function(e){if(e&&e.result){var n=e.result,i=n.actu_begin_date.split(" "),s=n.actu_end_date.split(" ");t.tinymce.get(r?"actu":"bonsplans").setContent(n.actu_text),t.$C.get(r?"#actu_id":"#bp_id").val(n.id),t.$C.get(r?"#actu_start":"#bp_start").val(i[0]),t.$C.get(r?"#actu_end":"#bp_end").val(s[0]),t.$C.get(r?"#edactu":"#edbp").show(),t.$C.get(r?".actuTab":".bonplandTab").hide()}};e("/Account/fiche/fiche","getFicheActu",[n],i)})(n.data("rel"),n.data("id")==1)},Ot=function(){t.$C.get(".copyMonday").click(O),t.$C.get("#countryChoose").change(c),t.$C.set(".summary .switch").click(X),t.$C.get("form.summary").submit(V),t.$C.get(".addElemFiche").click(J),t.$C.get(".validall").click(G),t.$C.get(".btnclosepopin").click(ut),t.$C.get("form input").focus(z),t.$C.get(".btnaddCat").click(d),t.$C.get(".addElemCat").click(v),t.$C.set(".editioncard #categorie").keyup(m),h.focus(function(){p.addClass("active")}).focusout(function(){p.removeClass("active")}),t.$C.get("#formupl").submit(ct),t.$C.get("#uplodfrm").onload=pt(),t.$C.get("#qualifierList button").click(mt),t.$C.get("#qualifierStandBy button").click(St),t.$C.get(".qualifiers .addqualifier button").click(yt),t.$C.get("#loadAll").click(function(){t.$C.get("section").removeClass("none"),$(this).addClass("none")}),t.$C.get(".newactubp").click(kt),t.$C.get(".cleditactubp").click(At),t.$C.get(".cldelactubp").click(Lt),t.$C.get(".clviewActuBpTab").click(Ct),t.$C.set("#edactu").focus(function(){W("#actu")})},Mt=function(){t.$C.$win.unbind("beforeunload")},_t=function(){Mt(),t.$C.$win.bind("beforeunload",function(){return'Vous avez modifié certains éléments de votre fiche.\nPour ne pas perdre ces modifications, vous devez cliquer sur le bouton "VALIDER" en bas de cette page.'})},Dt=function(e){at=e(),at.showPopinLogin(),t.$C.get("#connectionRecords").click(at.showPopinLogin)},Pt=function(e){at=e(),t.$C.get("#logoutRecords").click(at.logout)},Ht=function(){return Ot(),t.setTimeout(c,1e3),B(),j(),S(),E(),_(),nt(),lt(),t.$C.get("#connectionRecords").length>0?require(["login"],Dt):t.$C.get("#logoutRecords").length>0&&require(["login"],Pt),this};return Array.prototype.inArray=function(e){return this.indexOf(e)!=-1},Ht()}(window)});